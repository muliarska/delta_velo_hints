{"ast":null,"code":"var _jsxFileName = \"/home/slavko/Desktop/UCU_ files/Homework/Year_02/Part 02/WebDesign/React/main-velo-hints/src/Map.js\";\nimport React, { Component, useState, useEffect, useRef } from \"react\";\nimport { Map, TileLayer, withLeaflet, MapControl, Marker, Popup, LeafletConsumer, MapLayer } from \"react-leaflet\";\nimport MapInfo from \"./MapInfo\";\nimport Routing from \"./RoutingMachine\";\nimport L from \"leaflet\";\nimport \"leaflet-routing-machine\";\nimport './Icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA';\nvar routing = false;\nvar markers = [];\nvar control;\nvar map = NaN;\nvar route = NaN;\nvar modal = document.getElementById(\"myModal\");\nvar directionsStart = document.getElementById(\"directionsStart\");\nvar span = document.getElementsByClassName(\"close\")[0];\nvar badRoadReportButton = document.getElementById(\"badRoadReportButton\");\nvar accidentReportButton = document.getElementById(\"accidentReportButton\");\nvar parkingPlaceReportButton = document.getElementById(\"parkingPlaceReportButton\");\nvar closeButtonReport = document.getElementById(\"closeButtonReport\");\nvar cancelRouteButton = document.getElementById('cancelRouteButton');\nvar startMenuButton = document.getElementById('startMenuButton');\nvar startNewRouteButton = document.getElementById(\"startNewRouteButton\");\nvar closeButton = document.getElementById(\"closeButton\");\n\nfunction onLoad(e) {\n  // map.setView([coordinates], 8);\n  loadDirectionsStart();\n}\n\nfunction loadDirectionsStart(e) {\n  directionsStart.style.display = \"block\";\n}\n\nfunction startMenu() {\n  console.log(\"starting menu\");\n  cancelRouteButton.style.display = 'none';\n  startMenuButton.style.display = 'none';\n  loadDirectionsStart();\n}\n\nfunction cancelRoute(layer) {\n  console.log(\"canceling route\");\n  cancelRouteButton.style.display = 'none';\n  startMenuButton.style.display = 'inline-block';\n\n  if (route) {\n    route.removeRoute(route);\n  }\n}\n\nfunction makeReport(markers) {\n  var response = \"\";\n  modal.style.display = \"block\";\n\n  badRoadReportButton.onclick = function (event) {\n    modal.style.display = \"none\";\n    console.log(\"badRoadReportButton\");\n    response = \"badRoadReportButton\"; // marker.bindPopup(\"Bad Road\");\n    // marker.setIcon(badRoadIcon);\n  };\n\n  accidentReportButton.onclick = function (event) {\n    modal.style.display = \"none\";\n    console.log(\"accidentReportButton\");\n    response = \"accidentReportButton\"; // marker.bindPopup(\"Accident\");\n    // marker.setIcon(accidentIcon);\n  };\n\n  parkingPlaceReportButton.onclick = function (event) {\n    modal.style.display = \"none\";\n    console.log(\"parkingPlaceReportButton\");\n    response = \"parkingPlaceReportButton\"; // marker.bindPopup(\"Parking Place\");\n    // marker.setIcon(parkingIcon);\n  };\n\n  closeButtonReport.onclick = function (event) {\n    modal.style.display = \"none\";\n    console.log(\"Closing\");\n    startMenuButton.style.display = 'inline-block';\n    markers.pop();\n  };\n\n  return response;\n}\n\nstartNewRouteButton.onclick = function (event) {\n  directionsStart.style.display = \"none\";\n  console.log(\"Starting new route\");\n  routing = true;\n  cancelRouteButton.style.display = 'inline-block';\n  startMenuButton.style.display = 'none';\n};\n\ncloseButton.onclick = function (event) {\n  directionsStart.style.display = \"none\";\n  console.log(\"Closing start screen\");\n  startMenuButton.style.display = 'inline-block';\n}; // When the user clicks on <span> (x), close the modal\n\n\nspan.onclick = function () {\n  modal.style.display = \"none\";\n  directionsStart.style.display = \"none\";\n  startMenuButton.style.display = 'inline-block';\n}; // When the user clicks anywhere outside of the modal, close it\n\n\nwindow.onclick = function (event) {\n  if (event.target == modal) {\n    modal.style.display = \"none\";\n    startMenuButton.style.display = 'inline-block';\n  } else if (event.target == directionsStart) {\n    directionsStart.style.display = \"none\";\n    startMenuButton.style.display = 'inline-block';\n  }\n};\n\nstartMenuButton.onclick = function (event) {\n  startMenu();\n};\n\ncancelRouteButton.onclick = function (event) {\n  cancelRoute(map);\n};\n\nclass Route {\n  constructor(markers) {\n    // super();\n    this.route = NaN;\n    this.markers = markers;\n    this.createRoute();\n  }\n\n  createRoute() {\n    this.route = L.Routing.control({\n      router: L.Routing.mapbox(accessToken, {\n        unit: 'metric',\n        profile: 'mapbox/cycling',\n        language: 'en',\n        alternatives: true,\n        geometries: 'geojson',\n        controls: {\n          instructions: false\n        },\n        flyTo: false\n      }),\n      waypoints: [L.latLng(this.markers[0]['position']), L.latLng(this.markers[1]['position'])],\n      lineOptions: {\n        styles: [{\n          color: \"gray\",\n          opacity: 0.7,\n          weight: 6\n        }]\n      },\n      addWaypoints: false,\n      draggableWaypoints: false,\n      fitSelectedRoutes: false,\n      showAlternatives: true\n    }).addTo(map.leafletElement);\n    this.route.hide(); // handleFlyTo();\n    // function handleFlyTo() {\n    // const { current = {} } = useRef();\n    // const { leafletElement: map } = useRef(null);\n    // map.flyTo(markers[0]['position'], 14);\n    // }\n\n    routing = false; // .flyTo(markers[0]['position']);\n\n    return this.route;\n  }\n\n  removeRoute() {\n    this.route.remove();\n  }\n\n}\n\nfunction getIcon(name) {\n  console.log('./marker_icons/' + name + '.png');\n  return L.icon({\n    iconUrl: require('./marker_icons/'),\n    iconSize: [40, 40]\n  });\n}\n\nclass MapComponent extends React.Component {\n  constructor() {\n    super();\n\n    this.saveMap = layer => {\n      map = layer;\n      this.setState({\n        isMapInit: true\n      });\n      onLoad();\n    };\n\n    this.addMarker = e => {\n      // clearGeoResults();\n      console.log('clicked');\n      var coordinates = e.latlng;\n\n      if (!routing) {\n        const {\n          markers\n        } = this.state;\n        const resp = makeReport(markers);\n        this.forceUpdateHandler();\n        console.log(resp);\n        markers.push({\n          'name': 'marker',\n          'position': coordinates\n        });\n        this.setState({\n          markers\n        });\n      } else {\n        var {\n          routing_markers\n        } = this.state;\n        routing_markers.push({\n          'name': 'badRoad',\n          'position': coordinates\n        });\n\n        if (routing_markers.length == 2) {\n          route = new Route(routing_markers);\n          routing_markers = [];\n        }\n\n        this.setState({\n          routing_markers\n        });\n      }\n    };\n\n    this.forceUpdateHandler = this.forceUpdateHandler.bind(this);\n    this.state = {\n      lat: 49.918313,\n      lng: 24.182573,\n      zoom: 8,\n      isMapInit: false,\n      markers: [],\n      routing_markers: []\n    };\n  }\n\n  forceUpdateHandler() {\n    this.forceUpdate();\n  }\n\n  render() {\n    const {\n      lat,\n      lng,\n      zoom\n    } = this.state;\n    const position = [lat, lng];\n    return /*#__PURE__*/_jsxDEV(Map, {\n      className: \"map\",\n      center: position,\n      zoom: zoom,\n      onClick: this.addMarker,\n      ref: this.saveMap,\n      children: [/*#__PURE__*/_jsxDEV(TileLayer // url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      , {\n        url: \"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2xhdmtvcHJ5dHVsYSIsImEiOiJja281cnRmdjQwODl5MnZwZGdmeW1hb3N3In0.mhPtHgPEkyIHhGCQcNJNlA\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 9\n      }, this), this.state.markers.map((location, idx) => /*#__PURE__*/_jsxDEV(Marker, {\n        position: location.position,\n        icon: getIcon(location.name),\n        children: /*#__PURE__*/_jsxDEV(Popup, {\n          children: location.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 13\n        }, this)\n      }, `marker-${idx}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default MapComponent;","map":{"version":3,"sources":["/home/slavko/Desktop/UCU_ files/Homework/Year_02/Part 02/WebDesign/React/main-velo-hints/src/Map.js"],"names":["React","Component","useState","useEffect","useRef","Map","TileLayer","withLeaflet","MapControl","Marker","Popup","LeafletConsumer","MapLayer","MapInfo","Routing","L","accessToken","routing","markers","control","map","NaN","route","modal","document","getElementById","directionsStart","span","getElementsByClassName","badRoadReportButton","accidentReportButton","parkingPlaceReportButton","closeButtonReport","cancelRouteButton","startMenuButton","startNewRouteButton","closeButton","onLoad","e","loadDirectionsStart","style","display","startMenu","console","log","cancelRoute","layer","removeRoute","makeReport","response","onclick","event","pop","window","target","Route","constructor","createRoute","router","mapbox","unit","profile","language","alternatives","geometries","controls","instructions","flyTo","waypoints","latLng","lineOptions","styles","color","opacity","weight","addWaypoints","draggableWaypoints","fitSelectedRoutes","showAlternatives","addTo","leafletElement","hide","remove","getIcon","name","icon","iconUrl","require","iconSize","MapComponent","saveMap","setState","isMapInit","addMarker","coordinates","latlng","state","resp","forceUpdateHandler","push","routing_markers","length","bind","lat","lng","zoom","forceUpdate","render","position","location","idx"],"mappings":"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","sourcesContent":["import React, { Component, useState, useEffect, useRef } from \"react\";\nimport { Map, TileLayer, withLeaflet, MapControl, Marker, Popup, LeafletConsumer, MapLayer } from \"react-leaflet\";\nimport MapInfo from \"./MapInfo\";\nimport Routing from \"./RoutingMachine\";\nimport L from \"leaflet\";\nimport \"leaflet-routing-machine\";\nimport './Icons'\n\n\nconst accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA';\n\n\nvar routing = false;\nvar markers = [];\nvar control;\nvar map = NaN;\n\nvar route = NaN;\n\nvar modal = document.getElementById(\"myModal\");\nvar directionsStart = document.getElementById(\"directionsStart\");\nvar span = document.getElementsByClassName(\"close\")[0];\n\nvar badRoadReportButton = document.getElementById(\"badRoadReportButton\");\nvar accidentReportButton = document.getElementById(\"accidentReportButton\");\nvar parkingPlaceReportButton = document.getElementById(\"parkingPlaceReportButton\");\nvar closeButtonReport = document.getElementById(\"closeButtonReport\");\n\n\nvar cancelRouteButton = document.getElementById('cancelRouteButton');\nvar startMenuButton = document.getElementById('startMenuButton');\n\n\nvar startNewRouteButton = document.getElementById(\"startNewRouteButton\");\nvar closeButton = document.getElementById(\"closeButton\");\n\n\nfunction onLoad(e) {\n  // map.setView([coordinates], 8);\n  loadDirectionsStart();\n}\n\nfunction loadDirectionsStart (e) {\n  directionsStart.style.display = \"block\";\n}\n\nfunction startMenu() {\n  console.log(\"starting menu\");\n  cancelRouteButton.style.display = 'none';\n  startMenuButton.style.display = 'none';\n  loadDirectionsStart();\n}\n\nfunction cancelRoute(layer) {\n  console.log(\"canceling route\");\n  cancelRouteButton.style.display = 'none';\n  startMenuButton.style.display = 'inline-block';\n\n  if (route) {\n    route.removeRoute(route)\n  }\n}\n\n\n\nfunction makeReport(markers) {\n  var response = \"\";\n\n  modal.style.display = \"block\";\n\n  badRoadReportButton.onclick = function(event) {\n    modal.style.display = \"none\";\n    console.log(\"badRoadReportButton\")\n    response = \"badRoadReportButton\"\n    // marker.bindPopup(\"Bad Road\");\n    // marker.setIcon(badRoadIcon);\n  }\n\n  accidentReportButton.onclick = function(event) {\n    modal.style.display = \"none\";\n    console.log(\"accidentReportButton\")\n    response = \"accidentReportButton\"\n    // marker.bindPopup(\"Accident\");\n    // marker.setIcon(accidentIcon);\n  }\n\n  parkingPlaceReportButton.onclick = function(event) {\n    modal.style.display = \"none\";\n    console.log(\"parkingPlaceReportButton\")\n    response = \"parkingPlaceReportButton\"\n    // marker.bindPopup(\"Parking Place\");\n    // marker.setIcon(parkingIcon);\n  }\n\n  closeButtonReport.onclick = function(event) {\n    modal.style.display = \"none\";\n    console.log(\"Closing\")\n    startMenuButton.style.display = 'inline-block';\n    markers.pop();\n  }\n\n  return response;\n}\n\n\nstartNewRouteButton.onclick = function(event) {\n  directionsStart.style.display = \"none\";\n  console.log(\"Starting new route\");\n  routing = true;\n  cancelRouteButton.style.display = 'inline-block';\n  startMenuButton.style.display = 'none';\n}\n\ncloseButton.onclick = function(event) {\n  directionsStart.style.display = \"none\";\n  console.log(\"Closing start screen\")\n  startMenuButton.style.display = 'inline-block';\n}\n\n// When the user clicks on <span> (x), close the modal\nspan.onclick = function() {\n  modal.style.display = \"none\";\n  directionsStart.style.display = \"none\";\n  startMenuButton.style.display = 'inline-block';\n}\n\n// When the user clicks anywhere outside of the modal, close it\nwindow.onclick = function(event) {\n  if (event.target == modal) {\n    modal.style.display = \"none\";\n    startMenuButton.style.display = 'inline-block';\n  }\n  else if (event.target == directionsStart) {\n    directionsStart.style.display = \"none\";\n    startMenuButton.style.display = 'inline-block';\n  }\n}\n\n\n\nstartMenuButton.onclick = function(event) {\n  startMenu();\n}\n\ncancelRouteButton.onclick = function(event) {\n  cancelRoute(map);\n}\n\n\nclass Route {\n  constructor(markers) {\n    // super();\n    this.route = NaN;\n    this.markers = markers;\n    this.createRoute();\n  }\n\n  createRoute() {\n    this.route = L.Routing.control({\n      router: L.Routing.mapbox(accessToken, {\n        unit: 'metric',\n        profile : 'mapbox/cycling',\n        language: 'en',\n        alternatives: true,\n        geometries: 'geojson',\n        controls: { instructions: false },\n        flyTo: false\n      }),\n      waypoints: [\n        L.latLng(this.markers[0]['position']),\n        L.latLng(this.markers[1]['position'])\n      ],\n      lineOptions: {\n        styles: [\n          {\n            color: \"gray\",\n            opacity: 0.7,\n            weight: 6\n          }\n        ]\n      },\n      addWaypoints: false,\n      draggableWaypoints: false,\n      fitSelectedRoutes: false,\n      showAlternatives: true\n    }).addTo(map.leafletElement);\n    this.route.hide();\n\n    // handleFlyTo();\n    // function handleFlyTo() {\n      // const { current = {} } = useRef();\n      // const { leafletElement: map } = useRef(null);\n      // map.flyTo(markers[0]['position'], 14);\n    // }\n\n    routing = false;\n    // .flyTo(markers[0]['position']);\n\n    return this.route;\n  }\n\n  removeRoute() {\n    this.route.remove();\n  }\n}\n\n\n\nfunction getIcon(name) {\n  console.log('./marker_icons/' + name + '.png');\n  return L.icon({\n    iconUrl: require('./marker_icons/'),\n    iconSize: [40, 40]\n  })\n}\n\n\nclass MapComponent extends React.Component {\n  constructor() {\n    super();\n    this.forceUpdateHandler = this.forceUpdateHandler.bind(this);\n\n    this.state = {\n      lat: 49.918313,\n      lng: 24.182573,\n      zoom: 8,\n      isMapInit: false,\n\n      markers: [],\n      routing_markers: []\n\n    };\n  };\n  \n  saveMap = (layer) => {\n    map = layer;\n    this.setState({\n      isMapInit: true\n    });\n\n    onLoad();\n  };\n\n  forceUpdateHandler(){\n    this.forceUpdate();\n  };\n\n\n  addMarker = (e) => {\n    // clearGeoResults();\n    console.log('clicked')\n    var coordinates = e.latlng\n    \n    if (!routing) {\n      const {markers} = this.state\n      \n      const resp = makeReport(markers);\n      this.forceUpdateHandler();\n      console.log(resp)\n      markers.push({\n        'name': 'marker', \n        'position': coordinates\n      })\n      this.setState({markers})\n      \n    } else {\n      var {routing_markers} = this.state\n\n      routing_markers.push({\n        'name': 'badRoad', \n        'position': coordinates\n      })\n      \n      if (routing_markers.length == 2) {\n        route = new Route(routing_markers);\n        routing_markers = []\n      }\n      this.setState({routing_markers})\n    }\n  }\n\n\n\n  render() {\n    const { lat, lng, zoom } = this.state;\n    const position = [lat, lng];\n\n    return (\n      <Map className='map'\n        center={position} \n        zoom={zoom} \n\n        onClick={this.addMarker} \n        ref={this.saveMap}\n\n        >\n\n\n        <TileLayer\n          // url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n          url=\"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2xhdmtvcHJ5dHVsYSIsImEiOiJja281cnRmdjQwODl5MnZwZGdmeW1hb3N3In0.mhPtHgPEkyIHhGCQcNJNlA\"\n        />\n\n        {this.state.markers.map((location, idx) => (\n          <Marker \n            key={`marker-${idx}`} \n            position={location.position} \n            icon={getIcon(location.name)}\n            >\n              \n            <Popup>\n              {location.name}\n            </Popup>\n          </Marker>\n        ))}\n\n\n        {/* {this.state.routing_markers.map((location, idx) => (\n          <Marker \n            key={`marker-${idx}`} \n            position={location.position} \n            // icon={getIcon(location.name)}\n            >\n              \n            <Popup>\n              {location.name}\n            </Popup>\n          </Marker>\n        ))} */}\n\n      </Map>\n    );\n  }\n}\n\n\n\n\nexport default MapComponent;\n"]},"metadata":{},"sourceType":"module"}